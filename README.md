# CME Data Cleaning
## CME Market by Price data
The Chicago Mercantile Exchange (CME) broadcast Globex market data via Market Depth 3.0 platform. CME Market by Price (MBP) records each market data message sent to the CME at every trading day with nanosecond timestamp. Each message is aligned with a packet. MBP data is taped with the FIX (Finical Information eXchange) protocol. MBP aggregates the market data message at up to ten price depths of a limit order book (LOB) if traders submit, revise or cancel their orders. Each trade is also recorded in the MBP with distinct message tags. MBP data incremental refresh information of each price level of LOB through three update actions, add, modification, and cancellation, with different tag values corresponded to them, respectively. MBP is recorded for each commodity with various contracts at every trading day and one incremental refresh may contains multiple updates for different contracts, depending on when corresponding orders are recorded by the MBP. MBP records market data messages through a weekly rather than daily horizon, with update sequence number assigned continuously in a week, namely from Sunday to Friday. MBP could only update information related to each price level literally, while deeply individual order activities are not recorded in the MBP. Hence, MBP only dissimilates summary information of the best 10 depths of LOB and it is uncapable of tracking order details or identifying iceberg orders explicitly though the latter could be implicitly estimated. MBP data parsing mainly consists of two perspectives, one is trade summary and the other is book management. The former is usually defined as time and sales data while the latter could be further reconstructed as a n-depth limit order book (LOB) or a best bid-offer (BBO).

In terms of trade summary, all trades are recorded with specific message tags. Each trade is timestamped to nanosecond and a unique sequence number is also assigned if multiple trades occur with the same timestamps. Trade price and quantity executed are recorded for each trade. The number of orders traded on both sides of the match for a contract are defined properly when a market order matches displayed outright orders. When implied orders are matched, the above indicator is generally not accurate, as number of implied orders are not defined in CME. A trade aggressor is also defined in scenarios where market orders are known explicitly from which side. However, when a trade is initiated by implied orders or when data feed does not define which side a market order is from, no aggressor is defined.

When it comes to book management, one should reconstruct the limit order book from messages as MBP is not an explicitly well-designed LOB. Outright limit order book and implied limit order book should be reconstructed separately at first and they should be consolidated finally according to price levels. Each update action defines how the LOB updates for each price level. MBP can only show limit order book up to ten depths. The quantity and number of orders resting in each level can be defined for outright orders exclusively. For the add action, it indicates a better price than the current best quote entries the market, and one should put the previous depths backward, and fill up to ten depths of each side. When a message updated with modification action, one only needs to update the quantity and number of orders with respect to a price level, while no move occurs. In terms of update action of cancellation, it indicates a current depth will be deleted in a side of the LOB. One should move the rest depths forward and fill the first ten depths. Since the MBP only supports up to ten depths of a LOB, thus some last depths may be blank if liquidity does not replenish in time. Implied limit order book could be constructed with the same logic though the number of orders for each level is not defined in the MBP. MBP only records implied LOB up to two depths. The consolidated LOB can be reconstructed according to timestamps or sequence numbers chronologically. If price levels that have rest in the outright LOB, one needs to add the quantities of implied LOB to the outright LOB, where a consolidated LOB is defined. When a price level of implied LOB is better than that of outright LOB, this level for the consolidated LOB is the one at implied LOB and one should move price depths behind this level in the outright LOB backward. Consolidated LOB is the one that traders confront during trading. However, it does not mean the consolidated LOB is all liquidity available that a market has. For example, MBP does not support implied orders behind the second depth and the MBP only records electronic trading activities while blocked trading is recorded separately in other data feed.

## CME Market by Order data
CME Market by Order (MBO) is an order-based data feed that provides details of individual orders at each price level and the full depth of a limit order book. Similar as MBP, MBO is also timestamped to nanosecond and under FIX protocol. MBO records every customer order activity at each price level and transparency. Importantly, MBO can describe the queue of individual order at different price levels and relevant information about order submission, revision, execution and cancellation. Compared to the MBP data, the MBO extends the market data feed from aggregated level to individual level regarding to each incremental refresh without losing information conveyed by the MBP. Both MBP and MBO are extracted from the raw packet data directly from the market data feed and MBO data generally contain what contents the MBP has. Each packet (message) may consist of updates of multiple contracts with different maturities with a tag identifying which contract the message targets. Similarly, the data processing of MBO has two dimensions as well, one is trade summary and the other is book management. However, MBO can provide more details than MBP and some extra dimensions of market quality, such as fill rate, order elapsed time can be computed.

MBO data records each order with a unique order ID though the order may be revised, cancelled, filled, or discarded. The life of an order is tracked by the unique order ID. For each update other than execution, MBO assigns order priority number, from lowest to highest values, to position the order against other orders of the same side and price. According to CME Globex rulebook, an order loses its original order priority if the order quantity increases while the original order priority can be saved if the order quantity decreases. A lower value of order priority number means a higher priority. Any revision of a limit order, including price, and quantity will be recorded into MBO with the unique order ID. However, MBO does not flag what type of a limit order is, for instance, if an order is day order that will be discarded automatically by CME if it does not conclude per se, or a GTC (Good till Cancel) order that can rest in the LOB until this order will be filled. Similarly, the MBO does not flag stop orders, a FOK (Fill or Kill) order, or a FAK (Fill and Kill) order per se. Market orders are not flagged by the MBO though unique order IDs and order priority numbers are also assigned. Not all MBO messages are assigned unique sequence numbers like the MBP but all messages are assigned message numbers though they may not be unique in a few scenarios. The reconstruction of a full-depth LOB should sort each order at price levels at first then position orders at each price level according to their order priority numbers, from lowest to the highest values.

For the trade summary, what orders are traded against which orders can be recorded by the MBO. Generally, for each trade, if a market order is matched with one or multiple orders, a trade message contains what the MBP has plus which outright orders are matched against the market order, disclosing order ID(s), and trade size of each matched order. In addition, the order ID of this market order is also displayed in the MBO. However, implied order details are not recorded in the MBO. A trade ID is also assigned to track each transaction.

For order update actions, the MBO define them into three categories, addition, modification, and cancellation. However, the MBO updates are based on orders, which means that any modifications and cancellations may not necessarily be initiated by traders. For instance, when an order is filled, the MBO will generate a message exactly after the trade to update how many quantities left for execution for this order, with a modification tag shown on this message. However, this message is sent without a traderâ€™s initiation. Another example is the cancellation. If a trade fills all quantity that an order leaves, the MBO will generate a cancellation message exactly after the trade to indicate this order is concluded with the final trade. In addition, CME assumes each limit order submission is day order, and only traders submit GTC orders can CME flag them as non-day orders. Outstanding Non-day orders are resent on every Sunday at round 14:00 Central Time to reconstruct the initial LOB for each trading week. At the end of each day trading session, all resting days that are not executed or cancelled by traders per se will be deleted by the CME automatically with multiple messages with cancellation tags sent to the MBO.

MBO update may correspond with an update of MBP. When it happens, the MBO data dissimilates this scenario with dual updates in a message under a combined template, which indicates that the change in MBP is driven by the update in MBO. This message can clarify the reason why the limit order book is updated from an order perspective. However, asymmetric updates could occur as well and an incremental refresh of MBO may not result in an update of MBP since the order submitted at a price that where MBP cannot record. This could happen in the following scenarios: 1) the price is behind the best 10th level; 2) A cluster of (or massive) order activities occur in a short period of time and MBP only update their joint update; 3) When a submitted limit order that improves the best bid/ask price in LOB, the MBP may not be updated simultaneously but with certain time delay. In this scenario, different message template is used. In addition, if an update of MBP is not caused by an MBO update, the combined template will be applied but with asymmetric refreshes. This scenario may take place when market orders consume all liquidity at one or multiple depths and the rest depths need to be moved forward. This moving process is sent by updating messages of MBP though no specific order activities are pertinent to this. One should be cautious if MBO and MBP updates are updated simultaneously with the combined template.
## Additional information
For detailed data management, please refer to CME Group Client System Wiki at https://www.cmegroup.com/confluence/display/EPICSANDBOX/CME+Market+Data.
