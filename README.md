# CME MBP Data Cleaning
## CME Market by Price data
The Chicago Mercantile Exchange (CME) broadcast Globex market data via Market Depth 3.0 platform. CME Market by Price (MBP) records each market data message sent to the CME at every trading day with nanosecond timestamp. Each message is aligned with a packet. MBP data is taped with the FIX (Finical Information eXchange) protocol. MBP aggregates the market data message at up to ten price depths of a limit order book (LOB) if traders submit, revise or cancel their orders. Each trade is also recorded in the MBP with distinct message tags. MBP data incremental refresh information of each price level of LOB through three update actions, add, modification, and cancellation, with different tag values corresponded to them, respectively. MBP is recorded for each commodity with various contracts at every trading day and one incremental refresh may contains multiple updates for different contracts, depending on when corresponding orders are recorded by the MBP. MBP records market data messages through a weekly rather than daily horizon, with update sequence number assigned continuously in a week, namely from Sunday to Friday. MBP could only update information related to each price level literally, while deeply individual order activities are not recorded in the MBP. Hence, MBP only dissimilates summary information of the best 10 depths of LOB and it is uncapable of tracking order details or identifying iceberg orders explicitly though the latter could be implicitly estimated. MBP data parsing mainly consists of two perspectives, one is trade summary and the other is book management. The former is usually defined as time and sales data while the latter could be further reconstructed as a n-depth limit order book (LOB) or a best bid-offer (BBO).

In terms of trade summary, all trades are recorded with specific message tags. Each trade is timestamped to nanosecond and a unique sequence number is also assigned if multiple trades occur with the same timestamps. Trade price and quantity executed are recorded for each trade. The number of orders traded on both sides of the match for a contract are defined properly when a market order matches displayed outright orders. When implied orders are matched, the above indicator is generally not accurate, as number of implied orders are not defined in CME. A trade aggressor is also defined in scenarios where market orders are known explicitly from which side. However, when a trade is initiated by implied orders or when data feed does not define which side a market order is from, no aggressor is defined.

When it comes to book management, one should reconstruct the limit order book from messages as MBP is not an explicitly well-designed LOB. Outright limit order book and implied limit order book should be reconstructed separately at first and they should be consolidated finally according to price levels. Each update action defines how the LOB updates for each price level. MBP can only show limit order book up to ten depths. The quantity and number of orders resting in each level can be defined for outright orders exclusively. For the add action, it indicates a better price than the current best quote entries the market, and one should put the previous depths backward, and fill up to ten depths of each side. When a message updated with modification action, one only needs to update the quantity and number of orders with respect to a price level, while no move occurs. In terms of update action of cancellation, it indicates a current depth will be deleted in a side of the LOB. One should move the rest depths forward and fill the first ten depths. Since the MBP only supports up to ten depths of a LOB, thus some last depths may be blank if liquidity does not replenish in time. Implied limit order book could be constructed with the same logic though the number of orders for each level is not defined in the MBP. MBP only records implied LOB up to two depths. The consolidated LOB can be reconstructed according to timestamps or sequence numbers chronologically. If price levels that have rest in the outright LOB, one needs to add the quantities of implied LOB to the outright LOB, where a consolidated LOB is defined. When a price level of implied LOB is better than that of outright LOB, this level for the consolidated LOB is the one at implied LOB and one should move price depths behind this level in the outright LOB backward. Consolidated LOB is the one that traders confront during trading. However, it does not mean the consolidated LOB is all liquidity available that a market has. For example, MBP does not support implied orders behind the second depth and the MBP only records electronic trading activities while blocked trading is recorded separately in other data feed.

## Additional information
For detailed data management, please refer to CME Group Client System Wiki at https://www.cmegroup.com/confluence/display/EPICSANDBOX/CME+Market+Data.
